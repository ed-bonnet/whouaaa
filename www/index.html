<!DOCTYPE html>
<html>
    <head>
        <style>
            body{width:0;}
        </style>
    </head>
    <body>

        <audio id="audio_bgm" controls autoplay loop>
            <source src="audio/兎田ぺこら Usada Pekora BGM [60 FPS].1440.mp3" type="audio/mpeg">
        </audio>

        <script src="http://threejs.org/build/three.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        
        <script>
            $('#audio_bgm').prop('volume', 0.1);
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth /window.innerHeight, 
                0.1, 
                1000
            );

            const renderer = new THREE.WebGLRenderer();

            renderer.setSize(window.innerWidth, window.innerHeight);
            $('body').append(renderer.domElement);

            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial({color: 0x00FF00});
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            camera.position.z = 5;

            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            renderer.domElement.addEventListener('click', raycast, false);

            function raycast(event){
                event.preventDefault();
                mouse.x = (event.clientX / renderer.domElement.clientWidth) * 2 - 1;
                mouse.y = - (event.clientY / renderer.domElement.clientHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                var intersects = raycaster.intersectObjects(scene.children);

                for (var i = 0; i < intersects.length; i++) {
                    console.log('CALLBACK on click', intersects[i]);
                    if(material.color.r !== 0){
                        console.log(material.color.r, 'cérouge');
                        material.color.setRGB(0, 1, 0);
                    }else if(material.color.g !== 0){
                        material.color.setRGB(0, 0, 1);
                    }else {
                        material.color.setRGB(1, 0, 0);
                    }
                        
                }
            };

            function animate() {
                requestAnimationFrame(animate);
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();


        </script>

    </body>
</html>